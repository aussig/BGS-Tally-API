---
openapi: 3.0.2
info:
  title: BGS-Tally
  version: 1.0.0
  description: An API to send and receive Elite Dangerous BGS and Thargoid War activity
    data reported by CMDRs. This API was designed for use by the BGS-Tally EDMC plugin.
  contact:
    name: Aussi
    url: https://github.com/aussig/BGS-Tally
  license:
    name: MIT License
    url: https://opensource.org/licenses/MIT
paths:
  /discovery:
    summary: Discover information about this server and its API capabilities
    get:
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discovery'
          description: Success
      summary: Fetch information about the server's capabilities
      description: 'A discovery response containing information about the application
        and endpoints '
  /events:
    summary: Real-time / near real-time event stream
    description: Send journal event entries with most data taken directly from the
      journal. Does add some client-side tracked information such as target system.
    post:
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/EventsEvent'
        required: true
      responses:
        "200":
          description: Success
        "401":
          description: No API key was supplied or the API key is invalid
      security:
      - KeyAccessSecurityScheme: []
      summary: Post one or more Journal Events
      description: |-
        This endpoint is used to post events that the server has requested via the discovery endpoint. Further, discovery allows the server to request that only events with field values matching specific RegEx.

        Events are batched up to a maximum specified in discovery. An array is expected, even if a single event is sent.

        Each event includes all field values passed directly from the Journal - those game-supplied fields are not included in this documentation. However, Events are also enhanced by BGS-Tally and those enhanced fields are documented below.
  /activities:
    summary: Handle BGS activity reports
    put:
      requestBody:
        description: Activity to add
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivitiesActivity'
        required: true
      responses:
        "200":
          description: Success
        "401":
          description: No API key was supplied or the API key is invalid
      security:
      - KeyAccessSecurityScheme: []
      operationId: putActivity
      summary: Add or update activity for a given tick
      description: Report activity for a given tick.
components:
  schemas:
    Error:
      anyOf:
      - required:
        - code
        - message
        type: object
        properties:
          code:
            format: int32
            type: integer
          message:
            type: string
      example:
        code: 400
        message: Error description
    Timestamp:
      format: date-time
      description: timestamp in YYYY-mm-ddTHH:MM:SS.SSSZ format
      type: string
      example: 2022-01-01T00:00:00Z
    TickID:
      description: |-
        The ID of the tick this activity should be associated with. This ID
         is originally generated by elitebgs.app and is unique for each tick.
      maxLength: 24
      minLength: 24
      type: string
      example: 639f422026842f7295280669
    Discovery:
      description: Container object for a discovery response
      required:
      - name
      - description
      - version
      type: object
      properties:
        name:
          description: The name of this server or application
          type: string
          example: Name of a sample server
        description:
          description: "A description of this server, it's purpose, why it's requesting\
            \ the data and what it will use the data for."
          type: string
          example: Description of a sample server
        url:
          description: "A URL, accessible via a web browser, for the user to get more\
            \ information about the server application. It may point to the home page\
            \ of the application if appropriate."
          type: string
          example: https://www.example.com
        version:
          description: The version of this API supported by the server.
          type: string
          example: 1.0.0
        events:
          $ref: '#/components/schemas/DiscoveryEvents'
          description: Configuration of the events this server accepts.
        endpoints:
          $ref: '#/components/schemas/DiscoveryEndpoints'
          description: "A definition of the endpoints accepted by this server, and\
            \ the configuration of each"
    DiscoveryEndpoint:
      description: Information about an API endpoint
      required:
      - minPeriod
      type: object
      properties:
        path:
          description: The path (appended to the API root URL) to this endpoint.
          type: string
          example: path/to/endpoint
        minPeriod:
          description: "The minimum permitted period between calls to this endpoint\
            \ by a client.  Clients may set their own minimum period, any value lower\
            \ than that will be ignored."
          type: integer
          example: "60"
        maxBatch:
          description: "Only applicable for 'events' endpoints. The maximum permitted\
            \ number of events to send in a single API call.  Clients may set their\
            \ own maximum batch size, any value higher than that will be ignored."
          type: integer
          example: "10"
    DiscoveryEndpoints:
      description: A container for describing API Endpoints
      type: object
      properties:
        activities:
          $ref: '#/components/schemas/DiscoveryEndpoint'
          description: The configuration of the activities endpoint.
        events:
          $ref: '#/components/schemas/DiscoveryEndpoint'
          description: The configuration of the events endpoint
    ActivitiesFactionData:
      description: BGS activity for a faction
      required:
      - name
      - state
      type: object
      properties:
        name:
          description: The faction name
          type: string
        state:
          description: The primary faction state
          type: string
        bvs:
          description: The Bounty Vouchers logged for this faction
          type: integer
        cbs:
          description: The Combat Bonds logged for this faction
          type: integer
        exobiology:
          description: The value of exobiology data sold for this faction
          type: integer
        exploration:
          description: The value of exploration data sold for this faction
          type: integer
        scenarios:
          description: The number of scenario wins logged for this faction
          type: integer
        stations:
          description: Array of stations with logged activity for this faction
          minItems: 1
          type: array
          items:
            $ref: '#/components/schemas/ActivitiesStation'
        czground:
          $ref: '#/components/schemas/ActivitiesCZs'
          description: The ground CZs logged for this faction.
        czspace:
          $ref: '#/components/schemas/ActivitiesCZs'
          description: The space CZs logged for this faction
        infprimary:
          description: The primary INF logged for this faction
          type: integer
        infsecondary:
          description: The secondary INF logged for this faction
          type: integer
        missionfails:
          description: The number of failed missions logged for this faction
          type: integer
        murdersground:
          description: The number of on-foot murders logged for this faction.
          type: integer
        murdersspace:
          description: The number of ship murders logged for this faction.
          type: integer
        tradebm:
          description: The Black Market profit logged for this faction
          type: integer
        tradebuy:
          $ref: '#/components/schemas/ActivitiesTrade'
          description: The trade purchases logged for this faction.
          maxItems: 4
          minItems: 4
        tradesell:
          $ref: '#/components/schemas/ActivitiesTrade'
          description: The trade sales logged for this faction.
          maxItems: 4
          minItems: 4
    ActivitiesFactionInformation:
      title: Root Type for FactionInformation
      description: |
        states are included textually, no case change. Values are same as the journal file.

        Since states changed relatively often in the past, FDev can then add and/or remove states without changes to the API.
      required:
      - state
      - name
      - influence
      type: object
      properties:
        name:
          type: string
        state:
          description: Primary faction state
          type: string
        influence:
          format: double
          type: number
        activeStates:
          description: ""
          type: array
          items:
            type: string
        recoveringStates:
          description: ""
          type: array
          items:
            type: string
        pendingStates:
          description: ""
          type: array
          items:
            type: string
      example:
        name: Kwati One
        state: War
        influence: 0.145291
        activeStates:
        - War
        - Boom
    ActivitiesLMH:
      description: "A trio of tracked values, for low, medium and high tracking."
      minProperties: 1
      required: []
      type: object
      properties:
        low:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Logged 'low' values
        high:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Logged 'high' values
        medium:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Logged 'medium' values
      additionalProperties: false
    ActivitiesSettlement:
      description: Data for a ground CZ Settlement
      required:
      - name
      - type
      - count
      type: object
      properties:
        name:
          description: The settlement name
          type: string
        type:
          description: "The CZ type for this settlement: h | m | l"
          type: string
        count:
          description: The number of times this settlement CZ has been completed
          type: integer
    ActivitiesStation:
      description: Data logged for a particular station
      required:
      - name
      type: object
      properties:
        name:
          description: The station name
          type: string
        twcargo:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Thargoid War cargo missions logged
        twescapepods:
          $ref: '#/components/schemas/ActivitiesLMH'
          description: Thargoid War escape pod (evac injured and critical injured)
            missions logged
        twmassacre:
          $ref: '#/components/schemas/ActivitiesThargoidVessels'
          description: Thargoid massacre missions logged
        twpassengers:
          $ref: '#/components/schemas/ActivitiesLMH'
          description: Thargoid War passenger missions logged
    ActivitiesSumCount:
      description: "A pair of values, one representing a sum and the other a count\
        \ - for example when tracking haulage missions, the sum would contain the\
        \ number of missions and the count would contain the total number of goods\
        \ shipped."
      required:
      - sum
      - count
      type: object
      properties:
        sum:
          description: The sum of the number of activities completed.
          type: integer
        count:
          description: 'The count of the number of individual items tracked. '
          type: integer
    ActivitiesSystemData:
      description: BGS data for a star system
      required:
      - name
      - address
      - factions
      type: object
      properties:
        name:
          description: The system name
          type: string
        address:
          format: int64
          description: The unique E:D system address
          type: integer
        factions:
          description: Reported activity per faction
          type: array
          items:
            $ref: '#/components/schemas/ActivitiesFactionData'
    ActivitiesThargoidVessels:
      description: Thargoid War vessel type missions logged
      minProperties: 1
      required: []
      type: object
      properties:
        cyclops:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Cyclops missions logged
        basilisk:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Basilisk missions logged
        medusa:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Medusa missions logged
        hydra:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Hydra missions logged
        orthrus:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Orthrus missions logged
        scout:
          $ref: '#/components/schemas/ActivitiesSumCount'
          description: Scout missions logged
      additionalProperties: false
    ActivitiesTrade:
      description: "Contains trade activity organised by bracket - Zero demand, low\
        \ demand and high demand."
      required:
      - high
      - low
      type: object
      properties:
        zero:
          $ref: '#/components/schemas/ActivitiesTradeBracket'
          description: "Zero demand trade bracket. Items not listed on the market,\
            \ but sold anyway because the player had them in cargo"
        low:
          $ref: '#/components/schemas/ActivitiesTradeBracket'
          description: Low demand trade
        high:
          $ref: '#/components/schemas/ActivitiesTradeBracket'
          description: High demand trade
    ActivitiesTradeBracket:
      description: ""
      required:
      - items
      - value
      type: object
      properties:
        items:
          description: The number of items traded
          type: integer
        value:
          description: The value of the items traded
          type: integer
        profit:
          description: The profit on the items - only applicable for trade sales
          type: integer
    ActivitiesCZs:
      description: The type and count of each CZ logged for this faction
      minProperties: 1
      type: object
      properties:
        high:
          description: The number of high CZs logged.
          minimum: 0
          type: integer
        medium:
          description: The number of medium CZs logged
          type: integer
        low:
          description: The number of low CZs logged
          type: integer
        settlements:
          description: "For ground CZs only, an array of Settlements fought at"
          type: array
          items:
            $ref: '#/components/schemas/ActivitiesSettlement'
      additionalProperties: false
    ActivitiesActivity:
      required:
      - tickid
      - systems
      - cmdr
      - timestamp
      properties:
        systems:
          description: Array of systems with activity
          type: array
          items:
            $ref: '#/components/schemas/ActivitiesSystemData'
        cmdr:
          description: The Commander name
          type: string
        timestamp:
          $ref: '#/components/schemas/Timestamp'
          description: ""
        tickid:
          $ref: '#/components/schemas/TickID'
          description: |-
            The ID of the tick this activity should be associated with. This ID
             is originally generated by elitebgs.app and is unique for each tick.
          example: ""
    DiscoveryEvents:
      description: "A description of the events that the server is requesting, and\
        \ optional filter(s) for each event.\n\nNote only 3 example events are shown\
        \ here, while in practise any valid E:D event name can be specified.\n\nEnsure\
        \ that only the specific events you need are included. Requesting some events\
        \ can cause a lot of traffic to your server, for example FSSSignalDiscovered\
        \ when entering a large system.\n\nData senders should re-query your discovery\
        \ endpoint \"regularly\" - at a minimum on initial launch of the sender if\
        \ it is a desktop application. This allows you to change the set of requested\
        \ events at any time, and start receiving those events. "
      type: object
      properties:
        ApproachSettlement:
          $ref: '#/components/schemas/DiscoveryEvent'
          description: ""
        MissionAccepted:
          $ref: '#/components/schemas/DiscoveryEvent'
          description: ""
        FactionKillBond:
          $ref: '#/components/schemas/DiscoveryEvent'
          description: ""
    DiscoveryEvent:
      description: "An event accepted by the server, with optional additional filters."
      type: object
      properties:
        filters:
          $ref: '#/components/schemas/DiscoveryFilters'
          description: "A set of filters to be applied to each particular instance\
            \ of the event. If all filters match, the event should be sent to the\
            \ server."
    DiscoveryFilters:
      description: |-
        Filters to be applied to this event type, where the name is the event field name and the value is a RegEx expression for matching. If the event matches all of the filters, it should be sent to the server.

        Note that four example field names are shown here. In practise, any valid E:D event field name found in this event type can be specified.
      type: object
      properties:
        Name:
          description: RegEx expression
          type: string
          example: ^Mission_TW
        KillerShip:
          description: RegEx expression
          type: string
          example: scout_hq|scout_nq|scout_q|scout|thargonswarm|thargon
        AwardingFaction:
          description: RegEx expression
          type: string
          example: ^\\$faction_PilotsFederation;$
        VictimFaction:
          description: RegEx expression
          type: string
          example: ^\\$faction_Thargoid;$
    EventsEvent:
      description: |-
        Journal event. Most data is passed directly from the logged event, including Frontier's ideosynchracies and inconsistencies. This is by design for flexibility.

        Some events are enhanced with additional information, for ease of implementation on the server side.
      required:
      - event
      - timestamp
      - tickid
      - StarSystem
      - SystemAddress
      - cmdr
      type: object
      properties:
        event:
          description: |-
            A journal event item. The default set of events are shown here for brevity, but a server can subscribe to any event that can be logged to the journal.

            Note that requesting some events can cause a lot of traffic to your server, for example FSSSignalDiscovered when entering a large system. Ensure you only request the specific events you need when responding to the discovery endpoint.
          enum:
          - ApproachSettlement
          - CarrierJump
          - CommitCrime
          - Died
          - Docked
          - FactionKillBond
          - FSDJump
          - Location
          - MarketBuy
          - MarketSell
          - MissionAbandoned
          - MissionAccepted
          - MissionCompleted
          - MissionFailed
          - MultiSellExplorationData
          - RedeemVoucher
          - SellExplorationData
          - StartUp
          type: string
          example: Location
        timestamp:
          $ref: '#/components/schemas/Timestamp'
          description: timestamp of an event in YYYY-mm-ddTHH:MM:SS.SSSZ format
        StarSystem:
          description: |-
            Enhance every event that doesn't already have it with the current StarSystem.

            Note CamelCase to match Frontier's StarSystem field name.
          type: string
          example: Mahia
        SystemAddress:
          format: int64
          description: |-
            Enhance every event that doesn't already have it with the current SystemAddress.

            Note CamelCase to match Frontier's SystemAddress field name.
          type: integer
          example: "358864491242"
        tickid:
          $ref: '#/components/schemas/TickID'
          description: |-
            The ID of the tick this activity should be associated with. This ID
             is originally generated by elitebgs.app and is unique for each tick.
          maxLength: 24
          minLength: 24
          example: 639f422026842f7295280669
        cmdr:
          description: The Commander name
          type: string
  securitySchemes:
    KeyAccessSecurityScheme:
      type: apiKey
      description: Access to the API via a key generated server-side.
      name: apikey
      in: header
security:
- KeyAccessSecurityScheme: []
